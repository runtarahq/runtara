{
  "name": "While Loop Workflow",
  "description": "Demonstrates the While step type for conditional looping with iteration limits",
  "steps": {
    "init": {
      "stepType": "Agent",
      "id": "init",
      "name": "Initialize Counter",
      "agentId": "transform",
      "capabilityId": "map-fields",
      "inputMapping": {
        "source": {
          "valueType": "reference",
          "value": "data"
        },
        "mapping": {
          "valueType": "immediate",
          "value": {
            "counter": "$.start",
            "target": "$.target",
            "step": "$.step"
          }
        }
      }
    },
    "loop": {
      "stepType": "While",
      "id": "loop",
      "name": "Increment Until Target",
      "condition": {
        "type": "operation",
        "op": "LT",
        "arguments": [
          { "valueType": "reference", "value": "steps.init.outputs.counter" },
          { "valueType": "reference", "value": "steps.init.outputs.target" }
        ]
      },
      "subgraph": {
        "name": "Loop Body",
        "description": "Increments the counter by step value",
        "steps": {
          "increment": {
            "stepType": "Agent",
            "id": "increment",
            "name": "Add Step to Counter",
            "agentId": "transform",
            "capabilityId": "map-fields",
            "inputMapping": {
              "source": {
                "valueType": "reference",
                "value": "steps.init.outputs"
              },
              "mapping": {
                "valueType": "immediate",
                "value": {
                  "counter": "$.counter",
                  "step": "$.step"
                }
              }
            }
          },
          "finish": {
            "stepType": "Finish",
            "id": "finish",
            "inputMapping": {
              "counter": {
                "valueType": "reference",
                "value": "steps.increment.outputs.counter"
              }
            }
          }
        },
        "entryPoint": "increment",
        "executionPlan": [
          { "fromStep": "increment", "toStep": "finish" }
        ],
        "variables": {},
        "inputSchema": {},
        "outputSchema": {}
      },
      "config": {
        "maxIterations": 100
      }
    },
    "finish": {
      "stepType": "Finish",
      "id": "finish",
      "name": "Output Final Counter",
      "inputMapping": {
        "finalValue": {
          "valueType": "reference",
          "value": "steps.loop.outputs.counter"
        },
        "iterations": {
          "valueType": "reference",
          "value": "steps.loop.outputs"
        }
      }
    }
  },
  "entryPoint": "init",
  "executionPlan": [
    { "fromStep": "init", "toStep": "loop" },
    { "fromStep": "loop", "toStep": "finish" }
  ],
  "variables": {},
  "inputSchema": {
    "type": "object",
    "properties": {
      "start": { "type": "integer", "description": "Starting counter value" },
      "target": { "type": "integer", "description": "Target value to reach" },
      "step": { "type": "integer", "description": "Increment step size" }
    },
    "required": ["start", "target", "step"]
  },
  "outputSchema": {
    "type": "object",
    "properties": {
      "finalValue": { "type": "integer" },
      "iterations": { "type": "object" }
    }
  }
}
