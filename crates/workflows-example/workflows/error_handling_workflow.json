{
  "name": "Error Handling Workflow",
  "description": "Demonstrates onError edge handling for graceful error recovery in workflows",
  "steps": {
    "start": {
      "stepType": "Agent",
      "id": "start",
      "name": "Initialize",
      "agentId": "transform",
      "capabilityId": "map-fields",
      "inputMapping": {
        "source": {
          "valueType": "reference",
          "value": "data"
        },
        "mapping": {
          "valueType": "immediate",
          "value": {
            "value": "$.value",
            "shouldFail": "$.shouldFail"
          }
        }
      }
    },
    "risky_operation": {
      "stepType": "Agent",
      "id": "risky_operation",
      "name": "Risky Operation",
      "agentId": "transform",
      "capabilityId": "map-fields",
      "inputMapping": {
        "source": {
          "valueType": "reference",
          "value": "steps.start.outputs"
        },
        "mapping": {
          "valueType": "immediate",
          "value": {
            "result": "$.value",
            "processed": "$.shouldFail"
          }
        }
      }
    },
    "handle_error": {
      "stepType": "Log",
      "id": "handle_error",
      "name": "Log Error",
      "level": "error",
      "message": "Operation failed, handling error gracefully",
      "context": {
        "errorMessage": {
          "valueType": "reference",
          "value": "error.message"
        },
        "failedStepId": {
          "valueType": "reference",
          "value": "error.stepId"
        },
        "originalInput": {
          "valueType": "reference",
          "value": "steps.start.outputs"
        }
      }
    },
    "fallback": {
      "stepType": "Agent",
      "id": "fallback",
      "name": "Fallback Processing",
      "agentId": "transform",
      "capabilityId": "map-fields",
      "inputMapping": {
        "source": {
          "valueType": "reference",
          "value": "steps.start.outputs"
        },
        "mapping": {
          "valueType": "immediate",
          "value": {
            "result": "$.value",
            "wasRecovered": true
          }
        }
      }
    },
    "success_finish": {
      "stepType": "Finish",
      "id": "success_finish",
      "name": "Success Output",
      "inputMapping": {
        "result": {
          "valueType": "reference",
          "value": "steps.risky_operation.outputs"
        },
        "status": {
          "valueType": "immediate",
          "value": "success"
        }
      }
    },
    "error_finish": {
      "stepType": "Finish",
      "id": "error_finish",
      "name": "Recovered Output",
      "inputMapping": {
        "result": {
          "valueType": "reference",
          "value": "steps.fallback.outputs"
        },
        "status": {
          "valueType": "immediate",
          "value": "recovered"
        }
      }
    }
  },
  "entryPoint": "start",
  "executionPlan": [
    { "fromStep": "start", "toStep": "risky_operation" },
    { "fromStep": "risky_operation", "toStep": "success_finish" },
    { "fromStep": "risky_operation", "toStep": "handle_error", "label": "onError" },
    { "fromStep": "handle_error", "toStep": "fallback" },
    { "fromStep": "fallback", "toStep": "error_finish" }
  ],
  "variables": {},
  "inputSchema": {
    "type": "object",
    "properties": {
      "value": { "type": "string", "description": "Value to process" },
      "shouldFail": { "type": "boolean", "description": "Whether to simulate a failure" }
    },
    "required": ["value"]
  },
  "outputSchema": {
    "type": "object",
    "properties": {
      "result": { "type": "object" },
      "status": { "type": "string", "enum": ["success", "recovered"] }
    }
  }
}
